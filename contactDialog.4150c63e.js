!function(e,t,r,n,a){var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},c="function"==typeof o.parcelRequirea1dd&&o.parcelRequirea1dd,s=c.cache||{},i="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function l(t,r){if(!s[t]){if(!e[t]){var n="function"==typeof o.parcelRequirea1dd&&o.parcelRequirea1dd;if(!r&&n)return n(t,!0);if(c)return c(t,!0);if(i&&"string"==typeof t)return i(t);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}u.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},u.cache={};var d=s[t]=new l.Module(t);e[t][0].call(d.exports,u,d,d.exports,this)}return s[t].exports;function u(e){var t=u.resolve(e);return!1===t?{}:l(t)}}l.isParcelRequire=!0,l.Module=function(e){this.id=e,this.bundle=l,this.exports={}},l.modules=e,l.cache=s,l.parent=c,l.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(l,"root",{get:function(){return o.parcelRequirea1dd}}),o.parcelRequirea1dd=l;for(var d=0;d<t.length;d++)l(t[d])}({asAuK:[function(e,t,r){var n=e("@parcel/transformer-js/src/esmodule-helpers.js");n.defineInteropFlag(r),n.export(r,"ContactDialogCtrl",(()=>c));var a=e("url:./tpl.html"),o=n.interopDefault(a);e("./_styles.scss");class c{grecaptchaCallbackResolver=()=>{};constructor(){c.grecaptchaScriptLoader||this.createScriptElement(),this.createDialogElement()}async createDialogElement(){this.element=document.createElement("dialog"),c.templateLoader||(c.templateLoader=fetch(o.default));const e=await c.templateLoader;this.element.innerHTML=await e.text(),this.element.querySelectorAll("input,textarea").forEach((e=>{e.setAttribute("placeholder"," ")})),this.element.querySelector(".dialog__btn-close").addEventListener("click",this.hide.bind(this)),this.element.querySelector(".gform").addEventListener("submit",this.onFormSubmit.bind(this))}createScriptElement(){c.grecaptchaScriptLoader=new Promise((e=>{const t=document.createElement("script");t.onload=()=>{const t=document.createElement("div");t.className="grecaptcha-wrapper",document.body.appendChild(t),window.grecaptcha.ready((()=>{window.grecaptcha.render(t,{sitekey:"6LdQaM8ZAAAAAJwBCtGEYIyh9u6be1rBOlsd-FWj",size:"invisible",callback:e=>this.grecaptchaCallbackResolver(e)}),e()}))},t.src="https://www.google.com/recaptcha/api.js?render=explicit",t.defer=!0,t.async=!0,document.body.appendChild(t)}))}async executeGrecaptcha(){const e=await new Promise((e=>{this.grecaptchaCallbackResolver=e,window.grecaptcha.execute()}));return window.grecaptcha.reset(),e}async sendContactData(e,t=0){return new Promise((async(r,n)=>{const a="https://script.google.com/macros/s/AKfycbzrISB5QwRuuwGTgkxgKp7DGENDHPcxZTcka2_LRQ0zULSf5Ec/exec?"+e,o=await this.executeGrecaptcha(),c=new XMLHttpRequest;c.open("POST",a+"&token="+encodeURIComponent(o)),c.setRequestHeader("Content-type","text/plain;charset=utf-8"),c.onreadystatechange=()=>{if(4===c.readyState)if(200===c.status){if("success"===JSON.parse(c.responseText).result)return r();++t<3?r(this.sendContactData(e,t)):n()}else n()},c.send()}))}isShown(){return"open"===this.element.getAttribute("open")}show(){requestAnimationFrame((()=>{this.element.setAttribute("open","open")}))}hide(){this.element.removeAttribute("open")}async onFormSubmit(e){await c.grecaptchaScriptLoader;const t=e.currentTarget,r=t.querySelector("button");r.disabled=!0,e.preventDefault();const n=Array.prototype.slice.apply(t.querySelectorAll("input,textarea")).map((e=>encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))).join("&");await this.sendContactData(n).then((()=>{r.textContent="THX!",r.classList.remove("fill"),r.classList.add("pe-n")}),(()=>{})),r.disabled=!1}}},{"url:./tpl.html":"i1x0r","./_styles.scss":"8QASm","@parcel/transformer-js/src/esmodule-helpers.js":"6LO8L"}],i1x0r:[function(e,t,r){t.exports=e("./helpers/bundle-url").getBundleURL("dccJ2")+e("./helpers/bundle-manifest").resolve("jr3bn")},{"./helpers/bundle-url":"cr7JK","./helpers/bundle-manifest":"2pzd7"}],"8QASm":[function(){},{}]},[]);
//# sourceMappingURL=contactDialog.4150c63e.js.map
